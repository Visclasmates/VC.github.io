<!doctype html><html lang=en dir=ltr>
<head>
<meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1">
<meta name=description content="Punto 1 #  Ray Traicing #  El Ray Tracing es un algoritmo para síntesis de imágenes que calcula el camino de la luz como píxeles en un plano de la imagen y simula sus efectos sobre las superficies virtuales en las que incida. Esta técnica es capaz de producir imágenes con un alto grado de realismo, de una forma mayor que el renderizado mediante líneas de exploración tradicional, aunque el coste computacional del trazado de rayos es mucho mayor.">
<meta name=theme-color content="#FFFFFF">
<meta name=color-scheme content="light dark"><meta property="og:title" content>
<meta property="og:description" content="Punto 1 #  Ray Traicing #  El Ray Tracing es un algoritmo para síntesis de imágenes que calcula el camino de la luz como píxeles en un plano de la imagen y simula sus efectos sobre las superficies virtuales en las que incida. Esta técnica es capaz de producir imágenes con un alto grado de realismo, de una forma mayor que el renderizado mediante líneas de exploración tradicional, aunque el coste computacional del trazado de rayos es mucho mayor.">
<meta property="og:type" content="article">
<meta property="og:url" content="https://visclasmates.github.io/VC.github.io/docs/shortcodes/team/workshop2/"><meta property="article:section" content="docs">
<meta property="article:modified_time" content="2021-12-12T20:52:28-05:00">
<title>Workshop2 | Visual Computing</title>
<link rel=manifest href=/VC.github.io/manifest.json>
<link rel=icon href=/VC.github.io/favicon.png type=image/x-icon>
<link rel=stylesheet href=/VC.github.io/book.min.89a77f7e702a8626749b948bbfb01109823daf6c1246ca407d1378833494c402.css integrity="sha256-iad/fnAqhiZ0m5SLv7ARCYI9r2wSRspAfRN4gzSUxAI=" crossorigin=anonymous>
<script defer src=/VC.github.io/flexsearch.min.js></script>
<script defer src=/VC.github.io/en.search.min.8294673e79bb059ac73ba6a11f4ac7329f555df1b962e1c09927751ec8962523.js integrity="sha256-gpRnPnm7BZrHO6ahH0rHMp9VXfG5YuHAmSd1HsiWJSM=" crossorigin=anonymous></script>
</head>
<body dir=ltr>
<input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control>
<main class="container flex">
<aside class=book-menu>
<div class=book-menu-content>
<nav>
<h2 class=book-brand>
<a class="flex align-center" href=/VC.github.io/><span>Visual Computing</span>
</a>
</h2>
<div class=book-search>
<input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/>
<div class="book-search-spinner hidden"></div>
<ul id=book-search-results></ul>
</div>
<ul>
<li class=book-section-flat>
<span>Shortcodes</span>
<ul>
<li>
<a href=https://visclasmates.github.io/VC.github.io/docs/shortcodes/buttons/>Buttons</a>
</li>
<li>
<a href=https://visclasmates.github.io/VC.github.io/docs/shortcodes/columns/>Columns</a>
</li>
<li>
<a href=https://visclasmates.github.io/VC.github.io/docs/shortcodes/details/>Details</a>
</li>
<li>
<a href=https://visclasmates.github.io/VC.github.io/docs/shortcodes/expand/>Expand</a>
</li>
<li>
<a href=https://visclasmates.github.io/VC.github.io/docs/shortcodes/hints/>Hints</a>
</li>
<li>
<a href=https://visclasmates.github.io/VC.github.io/docs/shortcodes/katex/>Katex</a>
</li>
<li>
<a href=https://visclasmates.github.io/VC.github.io/docs/shortcodes/mermaid/>Mermaid</a>
</li>
<li>
<input type=checkbox id=section-ec67a64aba70b9df3d2a9acd6c92e3bc class=toggle>
<label for=section-ec67a64aba70b9df3d2a9acd6c92e3bc class="flex justify-between">
<a href=https://visclasmates.github.io/VC.github.io/docs/shortcodes/p5/>P5</a>
</label>
<ul>
<li>
<a href=https://visclasmates.github.io/VC.github.io/docs/shortcodes/p5/div/>Div</a>
</li>
<li>
<a href=https://visclasmates.github.io/VC.github.io/docs/shortcodes/p5/iframe/>Iframe</a>
</li>
</ul>
</li>
<li>
<a href=https://visclasmates.github.io/VC.github.io/docs/shortcodes/tabs/>Tabs</a>
</li>
<li>
<input type=checkbox id=section-5e90dfc1cda674fda3ec0abb0b45bf6a class=toggle checked>
<label for=section-5e90dfc1cda674fda3ec0abb0b45bf6a class="flex justify-between">
<a href=https://visclasmates.github.io/VC.github.io/docs/shortcodes/team/>Team</a>
</label>
<ul>
<li>
<a href=https://visclasmates.github.io/VC.github.io/docs/shortcodes/team/etrobertot/>Etrobertot</a>
</li>
<li>
<a href=https://visclasmates.github.io/VC.github.io/docs/shortcodes/team/jsnietogi/>Jsnietogi</a>
</li>
<li>
<a href=https://visclasmates.github.io/VC.github.io/docs/shortcodes/team/KevinIbarra/>Kevin Ibarra</a>
</li>
<li>
<a href=https://visclasmates.github.io/VC.github.io/docs/shortcodes/team/workshop2/ class=active>Workshop2</a>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<ul>
<li>
<a href=/VC.github.io/posts/>
Blog
</a>
</li>
</ul>
</nav>
<script>(function(){var a=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(b){localStorage.setItem("menu.scrollTop",a.scrollTop)}),a.scrollTop=localStorage.getItem("menu.scrollTop")})()</script>
</div>
</aside>
<div class=book-page>
<header class=book-header>
<div class="flex align-center justify-between">
<label for=menu-control>
<img src=/VC.github.io/svg/menu.svg class=book-icon alt=Menu>
</label>
<strong>Workshop2</strong>
<label for=toc-control>
<img src=/VC.github.io/svg/toc.svg class=book-icon alt="Table of Contents">
</label>
</div>
<aside class="hidden clearfix">
<nav id=TableOfContents>
<ul>
<li>
<ul>
<li><a href=#punto-1>Punto 1</a></li>
</ul>
</li>
<li><a href=#ray-traicing>Ray Traicing</a></li>
<li><a href=#ray-tracing-en-tiempo-real>Ray Tracing en tiempo real</a>
<ul>
<li><a href=#photon-mapping>Photon Mapping</a></li>
</ul>
</li>
<li><a href=#contextualización-histórica>Contextualización Histórica</a></li>
<li><a href=#qué-es-photon-mapping>¿Qué es Photon Mapping?</a></li>
<li><a href=#ventajas-de-photon-mapping>Ventajas de photon mapping</a></li>
<li><a href=#emisión-de-fotones-desde-una-fuente>Emisión de fotones desde una fuente</a></li>
<li><a href=#emisión-de-fotones-desde-múltiples-fuentes>Emisión de fotones desde múltiples fuentes</a></li>
<li><a href=#mapas-de-proyección>Mapas de proyección</a></li>
<li><a href=#trazado-de-fotones>Trazado de fotones</a></li>
<li><a href=#almacenamiento-de-fotones>Almacenamiento de Fotones</a></li>
<li><a href=#rasterizacion>rasterizacion</a>
<ul>
<li><a href=#punto-2>Punto 2</a></li>
</ul>
</li>
</ul>
</nav>
</aside>
</header>
<article class=markdown><h2 id=punto-1>
Punto 1
<a class=anchor href=#punto-1>#</a>
</h2>
<h1 id=ray-traicing>
Ray Traicing
<a class=anchor href=#ray-traicing>#</a>
</h1>
<p>El Ray Tracing es un algoritmo para síntesis de imágenes que calcula el camino de la luz como píxeles en un plano de la imagen y simula sus efectos sobre las superficies virtuales en las que incida. Esta técnica es capaz de producir imágenes con un alto grado de realismo, de una forma mayor que el renderizado mediante líneas de exploración tradicional, aunque el coste computacional del trazado de rayos es mucho mayor.</p>
<p>En el algoritmo de emisión de rayos se determinan las superficies visibles en la escena que se quiere sintetizar trazando rayos desde el observador (cámara) hasta la escena a través del plano de la imagen. Se calculan las intersecciones del rayo con los diferentes objetos de la escena y aquella intersección que esté más cerca del observador determina cuál es el objeto visible.</p>
<p>#imagen1</p>
<p>El algoritmo de trazado de rayos extiende la idea de trazar los rayos para determinar las superficies visibles con un proceso de sombreado (cálculo de la intensidad del píxel) que tiene en cuenta efectos globales de iluminación como pueden ser reflexiones, refracciones o sombras arrojadas.</p>
<p>Para simular los efectos de reflexión y refracción se trazan rayos recursivamente desde el punto de intersección que se está sombreando dependiendo de las características del material del objeto intersecado.</p>
<p>Para simular las sombras arrojadas se emiten rayos desde el punto de intersección hasta las fuentes de luz. Estos rayos se conocen con el nombre de rayos de sombra.</p>
<p>Esta no es una tecnología nueva, sino que se conoció por primera vez en 1979, presentada por Turner Whitted. De hecho, está ampliamente usada en todo tipo de vídeos y fotografías renderizados en 3D. El algoritmo básico de trazado de rayos fue mejorado por Robert Cook (1985) para simular otros efectos en las imágenes mediante el muestreo estocástico usando un método de Montecarlo; entre estos efectos podemos citar el desenfoque de movimiento, la profundidad de campo o el submuestreo para suavizar los bordes de la imagen resultante.</p>
<h1 id=ray-tracing-en-tiempo-real>
Ray Tracing en tiempo real
<a class=anchor href=#ray-tracing-en-tiempo-real>#</a>
</h1>
<p>¿Por qué no se usa el Ray Tracing en tiempo real en juegos? Porque el renderizado de una sola fotografía haciendo uso de Ray Tracing podría tardar minutos u horas; en cambio, para una película se usan gigantescas granjas de renderizado que probablemente cuesten millones y tarden horas o días en completar uno de estos procesos. Al menos hasta ahora, no era asumible hacer uso de ella en videojuegos.</p>
<p>#imagen2</p>
<h2 id=photon-mapping>
Photon Mapping
<a class=anchor href=#photon-mapping>#</a>
</h2>
<h1 id=contextualización-histórica>
Contextualización Histórica
<a class=anchor href=#contextualizaci%c3%b3n-hist%c3%b3rica>#</a>
</h1>
<p>El concepto Photon mapping, fue introducido por Henrik Wann Jensen en junio de 1996. A raíz de la necesidad de un algoritmo que fuera capaz de renderizar imágenes de geometría compleja con iluminación global.</p>
<p>En aquella época, estaba de moda el cálculo de radiosidad basado en elementos finitos (irradiance maps). Este tipo de método tiene dificultades a la hora de representar reflexión de la luz en superficies opacas (problema denominado BRDF), además problemas de optimización cuando la geometría a simular es compleja.</p>
<p>Para la solución a dicho problema se plantearon alternativas como técnicas multipaso, ilumination maps y las técnicas de ray traicing basadas en el método de Monte Carlo, estas ultimas consideradas como la mejor opción, las cual se reconsideraría debido al problema de ruido que presentan a consecuencia de la varianza en los resultados.</p>
<p>Dicho ruido en la técnica Ray Tracing se representa en la incapacidad de la técnica de representar aspectos como cáusticas, interreflexiones difusas, y medios participativos (niebla) en dichas escenas complejas. Otra ventaja sobre esta técnica es que Photon Mapping permite optimizar el tiempo de ejecución del proceso usando solo una fracción del tiempo de cómputo.</p>
<h1 id=qué-es-photon-mapping>
¿Qué es Photon Mapping?
<a class=anchor href=#qu%c3%a9-es-photon-mapping>#</a>
</h1>
<p>Es un método de “dos pasadas” o etapas:</p>
<ul>
<li>
<p>Trazado Fotónico (Photon Tracing). La primera pasada construye el mapa de fotones, emitiendo fotones desde la fuente de luz hacia la escena y almacenándolos en el mapa de fotones cuando estos no golpean en objetos especulares.</p>
</li>
<li>
<p>Radiación estimada (Radiance Estimate). La segunda pasada utiliza técnicas estadísticas sobre el mapa de fotones para extraer información acerca del flujo incidente y la radiancia reflejada en cualquier punto de la escena.</p>
</li>
</ul>
<h1 id=ventajas-de-photon-mapping>
Ventajas de photon mapping
<a class=anchor href=#ventajas-de-photon-mapping>#</a>
</h1>
<p>Comparado con Radiosidad. No es necesaria la generación de mallas; el método de Radiosidad es más rápido para escenas simples, pero a medida que la complejidad aumenta, photon mapping tiende a ser mejor. A su vez, Radiosidad está limitado a superficies difusas.</p>
<p>Comparado con métodos de Monte Carlo (path tracing, bidirectional-path tracing, Metrópolis) Photon mapping requiere mucha más memoria para almacenar los fotones. Photon mapping es más rápido y con resultados mejores dado que el error es de baja frecuencia, por tanto se nota menos que el ruido de alta frecuencia que en general poseen los métodos de Monte Carlo.</p>
<h1 id=emisión-de-fotones-desde-una-fuente>
Emisión de fotones desde una fuente
<a class=anchor href=#emisi%c3%b3n-de-fotones-desde-una-fuente>#</a>
</h1>
<p>Fotones emitidos desde un punto emisor de luz difusa, se distribuye uniformemente en direcciones aleatorias. Si se emite desde una fuente de luz direccional, los fotones van en la misma dirección, (con el origen fuera de la escena). Si la fuente de luz es un cuadrado emisor difuso, los fotones salen de posiciones aleatorias del cuadrado, con direcciones limitadas a una semiesfera. La dirección de emisión sigue una distribución coseno.</p>
<p>Puede manejar luces con cualquier forma y características de emisión. La probabilidad de emisión puede variar según el punto de emisión y la dirección.</p>
<h1 id=emisión-de-fotones-desde-múltiples-fuentes>
Emisión de fotones desde múltiples fuentes
<a class=anchor href=#emisi%c3%b3n-de-fotones-desde-m%c3%baltiples-fuentes>#</a>
</h1>
<p>La luz más fuerte emite más fotones (conviene que todos los fotones tengan potencia parecida). Más fuentes de luz no significa más fotones (cada luz contribuye menos a la iluminación total, y por tanto hay menos fotones por fuente de luz).</p>
<p>Si sólo unas pocas fuentes de luz son importantes, entonces se puede utilizar un “importance sampling map”, que concentra los fotones en las áreas que son de interés para el observador.</p>
<h1 id=mapas-de-proyección>
Mapas de proyección
<a class=anchor href=#mapas-de-proyecci%c3%b3n>#</a>
</h1>
<p>En escenas con geometría dispersa, muchos fotones no acertarán a ningún objeto.</p>
<p>#imagen3</p>
<p>Mapa de proyección es un mapa de la geometría tal como es vista desde la fuente de luz (ej. una proyección esférica centrada en una luz puntual, o una proyección plana en una luz direccional). El mapa contiene muchas celdas. Una celda está “on” cuando tiene una geometría proyectada en ella. Para acelerar la velocidad de la creación del mapa de proyección, se puede proyectar sobre este la esfera acotante de cada objeto o de un cluster de objetos. Conviene que haya un mapa de proyección para las superficies especulares (que generan cáusticas).</p>
<p>Estrategias para emitir los fotones:
– Loop recorriendo las celdas que contienen objetos y emitir fotones en direcciones que apunten a la celda. Problema potencial: se puede llenar el mapa de fotones antes de recorrer todas las celdas.
– Generar direcciones aleatorias y chequear si la celda correspondiente tiene algún objeto. Problema potencial: costoso en escenas dispersas.
– Para escenas dispersas: Elegir al azar una celda con objetos y luego una dirección al azar que apunte a la celda.</p>
<p>Hay que escalar la energía de los fotones basado en el número de celdas activas y el número de fotones emitidos.</p>
<p>#Ecuacion1</p>
<p>Donde P_ligth corresponde a las celdas con objetos y n_e al número total de celdas.</p>
<h1 id=trazado-de-fotones>
Trazado de fotones
<a class=anchor href=#trazado-de-fotones>#</a>
</h1>
<p>#Imagen4</p>
<p>En photon tracing los fotones propagan el flujo de energía que transporta. Existen 3 tipos de interacción del fotón con la superficie: reflexión, transmisión, absorción Si una superficie reflectiva tiene coeficientes de reflexión difusa d y de reflexión especular s (con s+d &lt;=1), se toma un valor aleatorio a  [0,1], y según qué valor tenga se decide qué interacción tendrá el fotón (ruleta rusa):</p>
<p>#imagen5</p>
<p>Hay que destacar que el fotón reflejado no pierde potencia, por ejemplo, di una superficie refleja el 50% de la luz incidente, solo la mitad de los fotones se reflejará, pero con toda la energía (este método se llama ruleta rusa). Otra solución podría ser reflejar todos los fotones, pero con la mitad de la potencia. Se considera más optima la implementación de la primera opción, por reducir los requerimientos de cómputo.</p>
<p>Si los fotones y las superficies son coloreadas (por ej. con colores RGB), se calcula Pd y Ps :</p>
<p>#Ecuación2</p>
<p>(d_r,d_g,d_b) son coeficientes de reflexión difusa para cada color.
⁡(P_r,P_g,P_b) indican la potencia del fotón en cada color.</p>
<p>#Ecuación3</p>
<p>⁡(s_r,s_g,s_b) son los coeficientes de reflexión especular.</p>
<p>#imagen6</p>
<p>El color del fotón reflejado debe variar, si por ejemplo se eligió una reflexión especular, la potencia del fotón incidente p_inc es reflejada como p_refle que se calcula así:</p>
<p>#Ecuación4</p>
<p>Lo mismo se puede establecer para la reflexión difusa.
¿Por qué ruleta rusa?, Es preferible tener fotones de potencia similar. La estimación de radiancia es mucho mejor si se utilizan unos pocos fotones.
¿Por qué tomarse el trabajo de elegir?, Si se generan 2 fotones por superficie reflejada, luego de 8 interacciones tengo 256 fotones, en lugar de 1 único fotón (precisa mucha más memoria)
Problema con ruleta rusa incrementa la varianza de la solución. Se precisa suficiente cantidad de fotones para transmitir la reflexión verdadera de las superficies.</p>
<h1 id=almacenamiento-de-fotones>
Almacenamiento de Fotones
<a class=anchor href=#almacenamiento-de-fotones>#</a>
</h1>
<p>Se almacenan solamente los aciertos en superficies difusas. La probabilidad de captar un fotón reflejado especularmente es 0. Si queremos renderizar reflexiones especulares detalladas, la mejor forma es realizar una traza de rayos del ojo hacia el espejo utilizando Ray Tracing estándar.</p>
<p>#Figure2_4</p>
<p>Para el resto, los datos se almacenan en una estructura única, llamada photon map o mapa de fotones. Cada fotón es almacenado varias veces a lo largo de su camino. También se almacena información acerca de un fotón en la superficie donde se absorbió, si esta es difusa.</p>
<p>Aplicaciones.
Ejemplo 1. Caja de Cornell generada con ray tracing y con sombras duras, generada en 3.5 s.</p>
<p>#Figure2_16</p>
<p>Ejemplo 2. Caja de Cornell generada con ray tracing y con sombras suaves, generada en 3.5 s.</p>
<p>#Figure2_17</p>
<p>Ejemplo 3. Caja de Cornell generada con ray tracing y con photon mapping para las cáusticas. Mapa de fotones de cáusticas tiene unos 50.000 fotones. La estimación utiliza unos 60 fotones. La generación de los fotones demoró 2 segundos. El rendering demoró 42 segundos.</p>
<p>#Figure2_18</p>
<p>Ejemplo 4. Iluminación global. La escena está mucho más iluminada. 200.000 fotones para mapa de fotones global y 100 fotones en el estimado. Generar los fotones costó 4 seg. El rendering demoró 66 seg.</p>
<p>#Figure2_19
#Figure2_20
#Figure2_21
#Figure2_22</p>
<p>Se utilizan 200.000 fotones en el mapa de fotones global y 50.000 fotones para el mapa de fotones de cáustica (idem que para el caso sencillo). El fractal tiene 1,6 millones de elementos. Tiempo de rendering fue de 14 minutos.</p>
<p>#Figure2_24</p>
<p>Se utilizan 100.000 fotones en el mapa de fotones global y 200.000 fotones para el mapa de fotones de volumen. Tiempo de rendering fue de 44 minutos.</p>
<p>#Figure2_26</p>
<h1 id=rasterizacion>
rasterizacion
<a class=anchor href=#rasterizacion>#</a>
</h1>
<iframe id=sketch5 style=width:640px;height:640px srcdoc="
        <!DOCTYPE html>
        <html>
          <head>
            <script src=https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.0/p5.min.js></script>
            <script src=https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.0/addons/p5.sound.min.js></script>
            
            
            
            
            
            <script src=../js/sketch5.js></script>
          </head>
          <body>
          </body>
        </html>
      "></iframe>
<h2 id=punto-2>
Punto 2
<a class=anchor href=#punto-2>#</a>
</h2>
<iframe id=sketch4 style=width:640px;height:640px srcdoc="
        <!DOCTYPE html>
        <html>
          <head>
            <script src=https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.0/p5.min.js></script>
            <script src=https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.0/addons/p5.sound.min.js></script>
            
            
            
            
            
            <script src=../js/sketch4.js></script>
          </head>
          <body>
          </body>
        </html>
      "></iframe>
</article>
<footer class=book-footer>
<div class="flex flex-wrap justify-between">
<div><a class="flex align-center" href=https://github.com/visclasmates/VC.github.io/commit/9a5253929582d9edcbe237e62d4f896699c9e5a0 title="Last modified by etrobertot | December 13, 2021" target=_blank rel=noopener>
<img src=/VC.github.io/svg/calendar.svg class=book-icon alt=Calendar>
<span>December 13, 2021</span>
</a>
</div>
</div>
<script>(function(){function a(c){const a=window.getSelection(),b=document.createRange();b.selectNodeContents(c),a.removeAllRanges(),a.addRange(b)}document.querySelectorAll("pre code").forEach(b=>{b.addEventListener("click",function(c){a(b.parentElement),navigator.clipboard&&navigator.clipboard.writeText(b.parentElement.textContent)})})})()</script>
</footer>
<div class=book-comments>
</div>
<label for=menu-control class="hidden book-menu-overlay"></label>
</div>
<aside class=book-toc>
<div class=book-toc-content>
<nav id=TableOfContents>
<ul>
<li>
<ul>
<li><a href=#punto-1>Punto 1</a></li>
</ul>
</li>
<li><a href=#ray-traicing>Ray Traicing</a></li>
<li><a href=#ray-tracing-en-tiempo-real>Ray Tracing en tiempo real</a>
<ul>
<li><a href=#photon-mapping>Photon Mapping</a></li>
</ul>
</li>
<li><a href=#contextualización-histórica>Contextualización Histórica</a></li>
<li><a href=#qué-es-photon-mapping>¿Qué es Photon Mapping?</a></li>
<li><a href=#ventajas-de-photon-mapping>Ventajas de photon mapping</a></li>
<li><a href=#emisión-de-fotones-desde-una-fuente>Emisión de fotones desde una fuente</a></li>
<li><a href=#emisión-de-fotones-desde-múltiples-fuentes>Emisión de fotones desde múltiples fuentes</a></li>
<li><a href=#mapas-de-proyección>Mapas de proyección</a></li>
<li><a href=#trazado-de-fotones>Trazado de fotones</a></li>
<li><a href=#almacenamiento-de-fotones>Almacenamiento de Fotones</a></li>
<li><a href=#rasterizacion>rasterizacion</a>
<ul>
<li><a href=#punto-2>Punto 2</a></li>
</ul>
</li>
</ul>
</nav>
</div>
</aside>
</main>
</body>
</html>